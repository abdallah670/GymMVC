@model GymBLL.ModelVM.Member.MemberDietWorkoutPlansVM


@{
    ViewData["Title"] = "Member Details";
   

    // Check if member has workout and diet plans
    bool hasWorkout = ViewBag.hasWorkout != null && (bool)ViewBag.hasWorkout;
    bool hasDiet = ViewBag.hasDiet != null && (bool)ViewBag.hasDiet;
    var returnPage = Context.Request.Query["page"].FirstOrDefault() ?? "1";
    var currentUrl = $"{Context.Request.Path}{Context.Request.QueryString}";
}

<div class="member-details-wrapper">
    <!-- Back Button -->
    <div class="assignment-header">
        @if (!string.IsNullOrEmpty(ViewBag.ReturnUrl))
        {
            <a href="@ViewBag.ReturnUrl" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-1"></i> Back to Members
            </a>
        }
        else
        {
            <a asp-action="Index" asp-route-page="@returnPage" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-1"></i> Back to Members
            </a>
        }
    </div>

    <!-- Member Profile Header -->
    <div class="member-header-gradient">
        <div class="d-flex align-items-center gap-3">

            @if (!string.IsNullOrEmpty(Model.ProfilePicture))
            {
                <img src="@Model.ProfilePicture" alt="@Model.FullName"
                     class="member-avatar-md rounded-circle">
            }
            else
            {

                <img src="~/uploads/profiles/default-profile.png" class="member-avatar-md rounded-circle" />
            }
            <div>
                <h2 class="mb-2 text-white">@Model.FullName</h2>
                <div class="opacity-75 mb-1">
                    <i class="fas fa-envelope me-1"></i> @Model.Email
                </div>
                @if (!string.IsNullOrEmpty(Model.Phone))
                {
                    <div class="opacity-75">
                        <i class="fas fa-phone me-1"></i> @Model.Phone
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="details-grid">
        <!-- Left Column -->
        <div class="d-flex flex-column gap-4">

            <!-- Member Information -->
            <div class="details-card">
                <h3 class="details-card-title">
                    <i class="fas fa-info-circle text-primary"></i> Member Information
                </h3>
                <div class="inline-grid-2">
                    <div>
                        <div class="label-muted">Join Date</div>
                        <div class="value-dark">@Model.JoinDate.ToString("MMMM dd, yyyy")</div>
                    </div>
                    @if (Model.FitnessGoal != null && !string.IsNullOrEmpty(Model.FitnessGoal.GoalName))
                    {
                        <div>
                            <div class="label-muted">Fitness Goal</div>
                            <div class="value-dark">@Model.FitnessGoal.GoalName</div>
                        </div>
                    }
                    <div>
                        <div class="label-muted">Current Weight</div>
                        <div class="value-dark">@Model.CurrentWeight kg</div>
                    </div>
                    <div>
                        <div class="label-muted">Height</div>
                        <div class="value-dark">@Model.Height cm</div>
                    </div>
                     <div>
                        <div class="label-muted">Age</div>
                        <div class="value-dark">@Model.Age </div>
                    </div>
                    <div>
                        <div class="label-muted">Gender</div>
                        <div class="value-dark">@Model.Gender</div>
                    </div>
                    <div>
                        <div class="label-muted">Activity Level</div>
                        <div class="value-dark">@Model.ActivityLevel</div>
                    </div>


                </div>

                @if (Model.FitnessGoal != null && !string.IsNullOrEmpty(Model.FitnessGoal.GoalDescription))
                {
                    <div class="mt-3 pt-3 border-top">
                        <div class="label-muted">Goal Description</div>
                        <div class="text-secondary small">@Model.FitnessGoal.GoalDescription</div>
                    </div>
                }
            </div>

            <!-- Assigned Workout Plans -->
            <div class="details-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="details-card-title mb-0">
                        <i class="fas fa-dumbbell"></i> Workout Plans
                    </h3>
                    @if (!hasWorkout || Model.WorkoutAssignmentVM == null)
                    {
                        <a asp-controller="WorkoutPlanAssignment"
                           asp-action="Assign"
                           asp-route-memberId="@Model.Id"
                           asp-route-returnUrl="@currentUrl"
                           class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i> Assign Plan
                        </a>
                    }
                    else
                    {
                        <div class="d-flex gap-2">
                            @if (Model.WorkoutAssignmentVM?.Id != null)
                            {
                                <a asp-controller="WorkoutPlanAssignment"
                                   asp-action="Details"
                                   asp-route-id="@Model.WorkoutAssignmentVM.Id"
                                   asp-route-returnUrl="@currentUrl"
                                   class="btn btn-primary btn-sm">
                                    <i class="fas fa-eye me-1"></i> Details
                                </a>
                            }
                           
                        </div>
                    }
                </div>

                <div id="workoutPlansContainer">
                    @if (!hasWorkout || Model.WorkoutAssignmentVM == null)
                    {
                        <div class="text-center py-5 text-muted" style="background: rgba(0,0,0,0.2); border-radius: var(--radius); border: 1px dashed var(--rule);">
                            <i class="fas fa-dumbbell fa-3x opacity-25 mb-3" style="color: var(--main-color);"></i>
                            <p class="mb-1 h5">No workout plan assigned</p>
                            <small>Click "Assign Plan" to get started</small>
                        </div>
                    }
                    else
                    {
                        <div class="p-4" style="background: rgba(0,0,0,0.3); border-radius: var(--radius); border: 1px solid var(--rule);">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <div class="value-dark h4 mb-1" style="color: var(--main-color);">
                                        @Model.WorkoutAssignmentVM?.WorkoutPlan?.Name
                                    </div>
                                    <div class="label-muted">
                                        <i class="fas fa-calendar-alt me-1"></i>
                                        @Model.WorkoutAssignmentVM?.StartDate.ToString("MMMM dd") -
                                        @Model.WorkoutAssignmentVM?.EndDate.ToString("MMMM dd, yyyy")
                                    </div>
                                </div>
                                <span class="badge" style="background: var(--main-color); color: var(--accent-ink);">
                                    @Model.WorkoutAssignmentVM.WorkoutPlan.DurationWeeks Weeks
                                </span>
                            </div>

                            @if (!string.IsNullOrEmpty(Model.WorkoutAssignmentVM?.Notes))
                            {
                                <div class="trainer-notes-box">
                                    <div class="label-muted mb-2">
                                        <i class="fas fa-sticky-note me-1"></i> Trainer Notes:
                                    </div>
                                    <div style="color: var(--ink); line-height: 1.6;">
                                        @Model.WorkoutAssignmentVM.Notes
                                    </div>
                                </div>
                            }

                            <div class="mt-4 d-flex justify-content-end gap-2">
                                <a href="@Url.Action("ViewTodayWorkout", "WorkoutPlanAssignment", new { assignmentId = Model.WorkoutAssignmentVM?.Id })"
                                   class="btn btn-primary btn-sm px-4">
                                    <i class="fas fa-play me-1"></i> Today's Workout
                                </a>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <!-- Assigned Diet Plans -->
            <div class="details-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="details-card-title mb-0">
                        <i class="fas fa-utensils"></i> Diet Plans
                    </h3>
                    @if (!hasDiet || Model.DietPlanAssignmentVM == null)
                    {
                        <a asp-controller="DietPlanAssignment"
                           asp-action="Assign"
                           asp-route-memberId="@Model.Id"
                           asp-route-returnUrl="@currentUrl"
                           class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i> Assign Plan
                        </a>
                    }
                    else
                    {
                        <div class="d-flex gap-2">
                            @if (Model.DietPlanAssignmentVM?.Id != null)
                            {
                                <a asp-controller="DietPlanAssignment"
                                   asp-action="Details"
                                   asp-route-id="@Model.DietPlanAssignmentVM.Id"
                                   asp-route-returnUrl="@currentUrl" 
                                   class="btn btn-primary btn-sm">
                                    <i class="fas fa-eye me-1"></i> Details
                                </a>
                            }
                            <a asp-controller="DietPlanAssignment"
                               asp-action="Edit"
                               asp-route-id="@Model.DietPlanAssignmentVM?.Id"
                               asp-route-returnUrl="@currentUrl"
                               class="btn btn-secondary btn-sm">
                                <i class="fas fa-edit me-1"></i> Edit
                            </a>
                        </div>
                    }
                </div>

                <div id="dietPlansContainer">
                    @if (!hasDiet || Model.DietPlanAssignmentVM == null)
                    {
                        <div class="text-center py-5 text-muted" style="background: rgba(0,0,0,0.2); border-radius: var(--radius); border: 1px dashed var(--rule);">
                            <i class="fas fa-utensils fa-3x opacity-25 mb-3" style="color: var(--main-color);"></i>
                            <p class="mb-1 h5">No diet plan assigned</p>
                            <small>Click "Assign Plan" to get started</small>
                        </div>
                    }
                    else
                    {
                        <div class="p-4" style="background: rgba(0,0,0,0.3); border-radius: var(--radius); border: 1px solid var(--rule);">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <div class="value-dark h4 mb-1" style="color: var(--main-color);">
                                        @Model.DietPlanAssignmentVM?.DietPlan?.Name
                                    </div>
                                    <div class="label-muted">
                                        <i class="fas fa-calendar-alt me-1"></i>
                                        @Model.DietPlanAssignmentVM?.StartDate.ToString("MMMM dd") -
                                        @Model.DietPlanAssignmentVM?.EndDate.ToString("MMMM dd, yyyy")
                                    </div>
                                    @if (Model.DietPlanAssignmentVM?.DietPlan?.TotalCalories > 0)
                                    {
                                        <div class="mt-2" style="color: var(--ink); font-weight: 500;">
                                            <i class="fas fa-fire me-1 text-warning"></i> @Model.DietPlanAssignmentVM.DietPlan.TotalCalories Calories/Day
                                        </div>
                                    }
                                </div>
                                <span class="badge" style="background: var(--info); color: white;">
                                    @Model.DietPlanAssignmentVM.DietPlan.DietType
                                </span>
                            </div>

                            <div class="mt-4 d-flex justify-content-end gap-2">
                                <a href="@Url.Action("TodayMeal", "DietPlanAssignment", new { assignmentId = Model.DietPlanAssignmentVM?.Id })"
                                   class="btn btn-primary btn-sm px-4">
                                    <i class="fas fa-utensil-spoon me-1"></i> Today's Meals
                                </a>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Right Column - Quick Actions & Stats -->
        <div class="d-flex flex-column gap-4">
            <!-- Quick Actions -->
            <div class="details-card">
                <h3 class="details-card-title">
                    <i class="fas fa-bolt text-warning"></i> Quick Actions
                </h3>
                <div class="d-grid gap-2">
                    @if (!hasWorkout)
                    {
                        <a asp-controller="WorkoutPlanAssignment"
                           asp-action="Assign"
                           asp-route-memberId="@Model.Id"
                           asp-route-returnUrl="@currentUrl"
                           class="btn btn-outline-primary text-start">
                            <i class="fas fa-dumbbell me-2"></i> Assign Workout Plan
                        </a>
                    }
                    else
                    {
                        <a asp-controller="WorkoutPlanAssignment"
                           asp-action="Edit"
                           asp-route-id="@Model.WorkoutAssignmentVM?.Id"
                           asp-route-returnUrl="@currentUrl"
                           class="btn btn-outline-primary text-start">
                            <i class="fas fa-edit me-2"></i> Edit Workout Plan
                        </a>
                    }

                    @if (!hasDiet)
                    {
                        <a asp-controller="DietPlanAssignment"
                           asp-action="Assign"
                           asp-route-memberId="@Model.Id"
                           asp-route-returnUrl="@currentUrl"
                           class="btn btn-outline-primary text-start">
                            <i class="fas fa-utensils me-2"></i> Assign Diet Plan
                        </a>
                    }
                    else
                    {
                        <a asp-controller="DietPlanAssignment"
                           asp-action="Edit"
                           asp-route-id="@Model.DietPlanAssignmentVM?.Id"
                           asp-route-returnUrl="@currentUrl" 
                           class="btn btn-outline-primary text-start">
                            <i class="fas fa-edit me-2"></i> Edit Diet Plan
                        </a>
                    }
                    <!-- REPORT BUTTON -->
                    <a asp-controller="Report" asp-action="Index"
                       asp-route-memberId="@Model.Id"
                       asp-route-returnUrl="@currentUrl"
                       class="btn btn-outline-primary text-start">
                     
                        <i class="fas fa-chart-bar"></i>
                        View Report
                    </a>
                  
                </div>
            </div>

            <!-- Member Stats -->
            <div class="details-card">
                <h3 class="details-card-title">
                    <i class="fas fa-chart-bar text-info"></i> Member Stats
                </h3>
                <div class="d-flex flex-column gap-3">
                    <div class="status-row">
                        <span class="label-muted mb-0">Workout Plan</span>
                        <span class="badge" style="background: @(hasWorkout ? "var(--success)" : "var(--frame)"); color: @(hasWorkout ? "var(--accent-ink)" : "var(--muted)");">
                            @(hasWorkout ? "Active" : "None")
                        </span>
                    </div>
                    <div class="status-row">
                        <span class="label-muted mb-0">Diet Plan</span>
                        <span class="badge" style="background: @(hasDiet ? "var(--success)" : "var(--frame)"); color: @(hasDiet ? "var(--accent-ink)" : "var(--muted)");">
                            @(hasDiet ? "Active" : "None")
                        </span>
                    </div>
                    @if (hasWorkout)
                    {
                        <div class="py-3 border-bottom" style="border-color: var(--rule) !important;">
                            <div class="label-muted mb-1">Current Workout</div>
                            <div class="value-dark small text-truncate" style="color: var(--main-color);">@Model.WorkoutAssignmentVM?.WorkoutPlan?.Name</div>
                        </div>
                    }
                    @if (hasDiet)
                    {
                        <div class="py-3">
                            <div class="label-muted mb-1">Current Diet</div>
                            <div class="value-dark small text-truncate" style="color: var(--main-color);">@Model.DietPlanAssignmentVM?.DietPlan?.Name</div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
