<!-- Subscription Status Card -->
<div id="subscriptionCard" class="dashboard-card" style="background: var(--tile); padding: 1.5rem; border-radius: var(--radius); border: 1px solid var(--frame);">
    <h3 style="margin-bottom: 1rem; color: var(--ink); display: flex; justify-content: space-between; align-items: center;">
        <span><i class="fas fa-id-card"></i> Subscription Status</span>
        <span id="statusBadge" class="badge badge-success" style="padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem;"></span>
    </h3>
    
    <div id="subscriptionContent">
        <!-- Loading State -->
        <div id="loadingState" style="text-align: center; padding: 2rem; color: var(--muted);">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
            <p style="margin-top: 1rem;">Loading subscription...</p>
        </div>

        <!-- Subscription Details (Hidden initially) -->
        <div id="subscriptionDetails" style="display: none;">
            <div class="subscription-info" style="display: flex; flex-direction: column; gap: 1rem;">
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--muted);">Plan:</span>
                    <span id="membershipType" style="font-weight: 600; color: var(--ink);"></span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--muted);">Expires:</span>
                    <span id="endDate" style="color: var(--ink);"></span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--muted);">Days Remaining:</span>
                    <span id="daysRemaining" style="font-weight: 600; font-size: 1.2rem;"></span>
                </div>
                
                <!-- Progress Bar -->
                <div style="margin-top: 0.5rem;">
                    <div style="background: var(--frame); height: 8px; border-radius: 4px; overflow: hidden;">
                        <div id="progressBar" style="background: linear-gradient(90deg, var(--main-color), var(--secondary-color)); height: 100%; transition: width 0.3s;"></div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div id="actionButtons" style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                <a href="@Url.Action("RenewSubscription", "Member")" class="btn btn-primary" style="flex: 1; text-align: center;">
                    <i class="fas fa-sync-alt"></i> Renew
                </a>
                <a href="@Url.Action("UpgradeSubscription", "Member")" class="btn btn-secondary" style="flex: 1; text-align: center;">
                    <i class="fas fa-arrow-up"></i> Upgrade
                </a>
            </div>

            <!-- Expiry Warning -->
            <div id="expiryWarning" style="display: none; margin-top: 1rem; padding: 1rem; background: color-mix(in srgb, var(--warning) 10%, transparent); border-left: 4px solid var(--warning); border-radius: var(--radius);">
                <div style="color: var(--warning); font-weight: 600;">
                    <i class="fas fa-exclamation-triangle"></i> Subscription Expiring Soon!
                </div>
                <div style="color: var(--muted); font-size: 0.9rem; margin-top: 0.5rem;">
                    Renew now to avoid losing access to your membership benefits.
                </div>
            </div>
        </div>

        <!-- No Subscription State -->
        <div id="noSubscription" style="display: none; text-align: center; padding: 2rem; color: var(--muted);">
            <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
            <p>No active subscription found.</p>
            <a href="@Url.Action("Create", "Member")" class="btn btn-primary" style="margin-top: 1rem;">
                <i class="fas fa-plus"></i> Get Started
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Load subscription status on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSubscriptionStatus();
        });

        async function loadSubscriptionStatus() {
            try {
                const response = await fetch('@Url.Action("GetSubscriptionStatus", "Member")');
                const data = await response.json();

                if (data.hasSubscription === false) {
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('noSubscription').style.display = 'block';
                    return;
                }

                // Hide loading, show details
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('subscriptionDetails').style.display = 'block';

                // Update status badge
                const statusBadge = document.getElementById('statusBadge');
                statusBadge.textContent = data.status;
                statusBadge.className = 'badge ' + data.statusBadgeClass;

                // Update subscription details
                document.getElementById('membershipType').textContent = data.membershipType;
                document.getElementById('endDate').textContent = new Date(data.endDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                
                // Update days remaining with color
                const daysRemainingEl = document.getElementById('daysRemaining');
                daysRemainingEl.textContent = data.daysRemaining + ' days';
                if (data.isExpired) {
                    daysRemainingEl.style.color = 'var(--danger)';
                } else if (data.isExpiringSoon) {
                    daysRemainingEl.style.color = 'var(--warning)';
                } else {
                    daysRemainingEl.style.color = 'var(--success)';
                }

                // Update progress bar
                document.getElementById('progressBar').style.width = data.progressPercentage + '%';

                // Show expiry warning if needed
                if (data.isExpiringSoon && !data.isExpired) {
                    document.getElementById('expiryWarning').style.display = 'block';
                }

                // Hide upgrade button if expired
                if (data.isExpired) {
                    document.querySelector('a[href*="UpgradeSubscription"]').style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading subscription status:', error);
                document.getElementById('loadingState').innerHTML = '<p style="color: var(--danger);">Error loading subscription</p>';
            }
        }
    </script>
}
