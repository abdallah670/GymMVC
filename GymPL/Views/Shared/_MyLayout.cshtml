<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MenoPro Gym - Transform Your Body, Transform Your Life</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="~/css/layout.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/components.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/form.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/assignment.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/trainer.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/member.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/plans.css" asp-append-version="true" />
    @* <link rel="stylesheet" href="~/css/test.css" asp-append-version="true" /> *@


    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" />
    <link rel="shortcut icon" type="image/x-icon" href="~/logo.ico" />
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'dark';
            if (theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    @await RenderSectionAsync("Head", required: false)
</head>
<body>
    @await Component.InvokeAsync("Header")
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // Global Toast Configuration
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        });

        window.showToast = (type, message) => {
            Toast.fire({
                icon: type,
                title: message
            });
        };

        // Handle TempData alerts
        @if (TempData["Success"] != null)
        {
            <text>showToast('success', '@TempData["Success"]');</text>
        }
        @if (TempData["Error"] != null)
        {
            <text>showToast('error', '@TempData["Error"]');</text>
        }

        // Initialize SignalR Notification Listener
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/notificationHub")
            .withAutomaticReconnect()
            .build();

        connection.on("ReceiveNotification", function(message) {
            showToast('info', message);
            
            // Optionally update a notification counter if it exists
            const badge = document.querySelector('.notification-badge');
            if (badge) {
                let count = parseInt(badge.innerText) || 0;
                badge.innerText = count + 1;
                badge.classList.remove('d-none');
            }
        });

        connection.start().catch(err => console.error(err.toString()));
    </script>
    
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <h5 class="alert-heading">Please fix the following errors:</h5>
            <ul class="mb-0">
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <li>@error.ErrorMessage</li>
                }
            </ul>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    <div class="container-fluid px-4">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>
  @if (!User.Identity.IsAuthenticated)
{

    <partial name="_Footer" />
}
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/dist/jquery.validate.unobtrusive.min.js"></script>
   
    
    
@await RenderSectionAsync("Scripts", required: false)
    <script src="~/js/animations.js" asp-append-version="true"></script>
</body>
</html>
