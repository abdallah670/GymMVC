@model GymBLL.ModelVM.Report.MemberReportVM
@{
    ViewData["Title"] = "Member Report";
    var returnUrl = ViewBag.ReturnUrl as string;
}

@section Head {
    <style>
        .report-header {
            background: var(--primary-gradient, linear-gradient(135deg, #4e73df 0%, #224abe 100%));
            color: white;
            padding: 2.5rem 2rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            box-shadow: var(--shadow-rest);
        }
        .stat-card {
            background: var(--tile);
            border: 1px solid var(--frame);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-rest);
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--accent);
            line-height: 1.2;
            margin-bottom: 0.25rem;
        }
        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
            font-weight: 600;
        }
        
        @@media print {
            body { background: white !important; color: black !important; }
            .navbar, .btn, footer, .theme-toggle-btn { display: none !important; }
            .report-header { background: #f8f9fa !important; color: black !important; border-bottom: 2px solid #000; box-shadow: none !important; }
            .stat-card { border: 1px solid #ddd !important; background: white !important; color: black !important; box-shadow: none !important; }
            .stat-value { color: black !important; }
            .text-white, .text-muted { color: black !important; }
        }
        
        .nav-tabs {
            border-bottom: 1px solid var(--frame) !important;
        }
        .nav-tabs .nav-link {
            border: none;
            color: var(--muted);
            transition: all 0.2s;
            font-weight: 600;
            padding: 1rem 1.5rem;
        }
        .nav-tabs .nav-link:hover {
            color: var(--ink);
            background: var(--bg);
        }
        .nav-tabs .nav-link.active {
            background: transparent;
            color: #0d6efd !important;
            border-bottom: 3px solid #0d6efd;
        }
    </style>
}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4 d-print-none">
        <a href="javascript:history.back()" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i>Back
        </a>
        <button onclick="window.print()" class="btn btn-primary">
            <i class="fas fa-print me-2"></i>Print Report
        </button>
    </div>

    <div class="report-header">
        <div class="row align-items-center">
            <div class="col-md-2 text-center text-md-start mb-3 mb-md-0">
                @if (!string.IsNullOrEmpty(Model.Member.ProfilePicture))
                {
                    <img src="@Model.Member.ProfilePicture" class="rounded-circle border border-3 border-white" style="width: 100px; height: 100px; object-fit: cover;" />
                }
                else
                {
                    <i class="fas fa-user-circle fa-6x"></i>
                }
            </div>
            <div class="col-md-7 text-center text-md-start">
                <h1 class="mb-1 fw-bold text-white">@Model.Member.FullName</h1>
                <p class="mb-3 opacity-75" style="font-size: 1.1rem;"><i class="fas fa-envelope me-2"></i>@Model.Member.Email</p>
                <div class="d-flex gap-2 justify-content-center justify-content-md-start">
                    <span class="badge bg-white bg-opacity-20 text-white border border-white border-opacity-25 px-3 py-2">
                        <i class="fas fa-user-clock me-1"></i> Member since @Model.Member.JoinDate.ToString("MMM yyyy")
                    </span>
                    <span class="badge bg-warning text-dark px-3 py-2">
                        <i class="fas fa-crown me-1"></i> @Model.MembershipType
                    </span>
                </div>
            </div>
            <div class="col-md-3 text-center text-md-end mt-3 mt-md-0">
                <div class="small opacity-75 text-uppercase letter-spacing-1 mb-1">Report Date</div>
                <div class="h4 fw-bold mb-0">@DateTime.Now.ToString("MMM dd, yyyy")</div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-md-3 col-6">
            <div class="stat-card">
                <div class="stat-value">@Model.TotalWorkoutsLogged</div>
                <div class="stat-label">Total Workouts</div>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="stat-card">
                <div class="stat-value">@Model.AverageWorkoutDuration <span class="fs-6 text-muted">min</span></div>
                <div class="stat-label">Avg Duration</div>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="stat-card">
                <div class="stat-value">@Model.CurrentWeight <span class="fs-6 text-muted">kg</span></div>
                <div class="stat-label">Current Weight</div>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="stat-card">
                <div class="stat-value">
                    @(Model.LastWorkoutDate.HasValue ? (int)(DateTime.UtcNow - Model.LastWorkoutDate.Value).TotalDays + "d" : "-")
                </div>
                <div class="stat-label">Since Last Workout</div>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs mb-4" id="reportTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="workouts-tab" data-bs-toggle="tab" data-bs-target="#workouts" type="button" role="tab">Workout History</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="meals-tab" data-bs-toggle="tab" data-bs-target="#meals" type="button" role="tab">Meal Log</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="weight-tab" data-bs-toggle="tab" data-bs-target="#weight" type="button" role="tab">Weight History</button>
        </li>
    </ul>

    <div class="tab-content" id="reportTabsContent">
        <!-- Workouts Tab -->
        <div class="tab-pane fade show active" id="workouts" role="tabpanel">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0" style="color: var(--ink); background: transparent;">
                    <thead style="background: var(--frame);">
                        <tr style="color: var(--ink); border-bottom: 1px solid var(--rule);">
                            <th class="ps-4 py-3 border-0 small fw-bold text-uppercase opacity-75">Date</th>
                            <th class="py-3 border-0 small fw-bold text-uppercase opacity-75">Plan</th>
                            <th class="py-3 border-0 small fw-bold text-uppercase opacity-75">Duration</th>
                            <th class="py-3 border-0 small fw-bold text-uppercase opacity-75">Exercises</th>
                            <th class="pe-4 py-3 border-0 small fw-bold text-uppercase opacity-75">Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.RecentLogs.Any())
                        {
                            @foreach(var log in Model.RecentLogs)
                            {
                                <tr style="background: transparent; border-bottom: 1px solid var(--rule);">
                                    <td class="ps-4">@log.Date.ToLocalTime().ToString("MMM dd, hh:mm tt")</td>
                                    <td class="fw-bold" style="color: var(--primary);">@log.WorkoutPlanName</td>
                                    <td>@log.DurationMinutes min</td>
                                    <td>
                                        @foreach(var entry in log.Entries.Take(3))
                                        {
                                            <span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary border-opacity-25 me-1">@entry.ExerciseName</span>
                                        }
                                        @if(log.Entries.Count > 3)
                                        {
                                            <span class="badge bg-dark bg-opacity-25 text-muted">+@(log.Entries.Count - 3)</span>
                                        }
                                    </td>
                                    <td class="pe-4 small fst-italic" style="color: var(--muted); opacity: 0.9;">@log.Notes</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr><td colspan="5" class="text-center text-muted">No workouts logged yet.</td></tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Meals Tab -->
        <div class="tab-pane fade" id="meals" role="tabpanel">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0" style="color: var(--ink); background: transparent;">
                    <thead style="background: var(--frame);">
                        <tr>
                            <th class="ps-4 py-3 border-0 small fw-bold text-uppercase opacity-75">Date</th>
                            <th class="py-3 border-0 small fw-bold text-uppercase opacity-75">Calories</th>
                            <th class="pe-4 py-3 border-0 small fw-bold text-uppercase opacity-75">Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.RecentMeals.Any())
                        {
                            @foreach(var log in Model.RecentMeals)
                            {
                                <tr style="background: transparent; border-bottom: 1px solid var(--rule);">
                                    <td class="ps-4">@log.Date.ToLocalTime().ToString("MMM dd, yyyy")</td>
                                    <td class="fw-bold" style="color: var(--success);">@(log.CaloriesConsumed.HasValue ? log.CaloriesConsumed + " kcal" : "-")</td>
                                    <td class="pe-4 small text-muted fst-italic" style="opacity: 0.9;">@log.Notes</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr><td colspan="3" class="text-center text-muted">No meals logged yet.</td></tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Weight Tab -->
        <div class="tab-pane fade" id="weight" role="tabpanel">
             <div class="table-responsive">
                <table class="table table-hover align-middle mb-0" style="color: var(--ink); background: transparent;">
                    <thead style="background: var(--frame);">
                        <tr>
                            <th class="ps-4 py-3 border-0 small fw-bold text-uppercase opacity-75">Date</th>
                            <th class="py-3 border-0 small fw-bold text-uppercase opacity-75">Weight (kg)</th>
                            <th class="py-3 border-0 small fw-bold text-uppercase opacity-75">Change</th>
                            <th class="pe-4 py-3 border-0 small fw-bold text-uppercase opacity-75">Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.WeightHistory.Any())
                        {
                            double? prevWeight = null;
                            @foreach(var log in Model.WeightHistory)
                            {
                                <tr style="background: transparent; border-bottom: 1px solid var(--rule);">
                                    <td class="ps-4">@log.DateRecorded.ToLocalTime().ToString("MMM dd, yyyy")</td>
                                    <td class="fw-bold">@log.Weight</td>
                                    <td>
                                        @if (prevWeight.HasValue)
                                        {
                                            var change = log.Weight - prevWeight.Value;
                                            var color = change > 0 ? "text-danger" : (change < 0 ? "text-success" : "text-muted");
                                            <span class="@color" style="font-weight: 600;">@(change > 0 ? "+" : "")@Math.Round(change, 1)</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                    <td class="pe-4 small text-muted fst-italic" style="opacity: 0.9;">@log.Notes</td>
                                </tr>
                                prevWeight = log.Weight;
                            }
                        }
                        else
                        {
                            <tr><td colspan="4" class="text-center text-muted">No weight history available.</td></tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="mt-5 p-4 border border-secondary rounded text-center d-none d-print-block">
        <p class="mb-0">Generated by MenoPro Gym Management System</p>
    </div>
</div>
